import{j as t,B as j,a0 as E,T as h,r as o,q as N,p as T,F as _,w as g,U as m,v as f}from"./index-RV5YIsxB.js";import{N as z,d as W,I as D}from"./ItemCard-f_CoiPR6.js";import{C as R}from"./ConfirmDialog-DBTw2uG_.js";import{C as u}from"./Container-BPfE54Zb.js";import"./Card-D_VzpON0.js";import"./CardMedia-CAhi13jz.js";import"./Zoom-CT9GbHCF.js";import"./styled-DolKx1nG.js";const U=({error:i})=>t.jsxs(j,{sx:{minHeight:"50vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",color:"error.main",px:2},children:[t.jsx(E,{sx:{fontSize:80,mb:2}}),t.jsx(h,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Something went wrong"}),t.jsx(h,{variant:"body1",children:i})]}),M=()=>{const[i,l]=o.useState(!1),[r,y]=o.useState(null),[C,p]=o.useState(!1),[w,c]=o.useState(null),[x,d]=o.useState([]),v=N(e=>e.persistData.user.userInfo),S=T(),$=()=>l(!1),F=()=>{r!=null&&r.id&&(B(r.id),l(!1))},I=e=>{y({id:e._id,name:e.name}),l(!0)},b=e=>{const s=`/listing/${e._id},${e.mainCategoryName},${e.subCategoryName||"null"}`;S(s)},k=async()=>{var e;p(!0);try{const{data:s}=await g.get(`${m}api/user/userInfo/${v.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!((e=s==null?void 0:s.favorites)!=null&&e.length)){d([]),c(null);return}const n=s.favorites.join(","),{data:a}=await g.get(`${m}api/listing/favoriteListings?ListingsId=${n}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});d(a),c(null)}catch(s){c(s.message||"Something went wrong."),f.error(s.message||"Failed to fetch favorites.")}finally{p(!1)}},B=async e=>{var s,n;try{if(!(await g.put(`${m}api/user/update/${v.id}`,{favorites:e,removeFavorites:!0},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data)throw new Error("Failed to remove from favorites.");f.success("Removed from favorites."),d(L=>L.filter(A=>A._id!==e))}catch(a){f.error(((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||a.message,{autoClose:3e3})}};return o.useEffect(()=>{k()},[]),C?t.jsx(_,{}):w?t.jsx(u,{maxWidth:"lg",sx:{py:6},children:t.jsx(U,{})}):x.length===0?t.jsx(u,{maxWidth:"lg",sx:{py:6},children:t.jsx(z,{message:"No Favorites",description:"You havenâ€™t saved anything yet.",icon:t.jsx(W,{sx:{fontSize:80,color:"grey.500",mb:2}})})}):t.jsxs(u,{maxWidth:"lg",sx:{pb:6},children:[t.jsx(h,{variant:"h5",align:"center",sx:{color:"green",mb:4},children:"Your Favorites"}),t.jsx(j,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:3,p:2,pb:8},children:x.map((e,s)=>t.jsx(D,{item:e,onDeleteClick:()=>I(e),showView:!0,onViewClick:b},e._id||s))}),t.jsx(R,{open:i,title:"Warning",message:`Are you sure to delete listing (${r==null?void 0:r.name})?`,onClose:$,onConfirm:F,cancelText:"Disagree",confirmText:"Agree"})]})};export{M as default};
