function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/WaveHeader-2ifJBkZW.js","assets/index-B5lp3evd.js","assets/index-DDnostVl.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as u,_ as O,u as M,b as N,$ as H,j as e,F as K,B as c,a as Q,a2 as V,z as P,c as w,U as F,A as n}from"./index-B5lp3evd.js";import{g as Y,r as J,u as X,a as Z}from"./index.esm2017-xdxYMBNT.js";import{a as ee}from"./firebase-Dc1fJsNB.js";import{C as se}from"./Container-Buy3LPWA.js";import{G as L}from"./Grid-x830jgZP.js";import{T as d}from"./TextField-B_elwkSM.js";import{F as p}from"./FormControlLabel-BFRif6CJ.js";import{C as h}from"./Checkbox-C1So7GVP.js";import"./styled-Dql5uali.js";import"./useFormControl-B6FoJptF.js";import"./isMuiElement-Cht4bAAw.js";const ae=u.lazy(()=>O(()=>import("./WaveHeader-2ifJBkZW.js"),__vite__mapDeps([0,1,2]))),m=3e3,fe=()=>{const[x,I]=u.useState([]),[k,j]=u.useState(),[b,g]=u.useState(!1),D=M(),t=N(D.breakpoints.down("md")),{listingId:S}=H(),[T,v]=u.useState(!1),[a,f]=u.useState({type:"rent",description:"",imageURLs:[],parking:!1,furnished:!1,offer:!1,bedrooms:1,bath:1,regularPrice:1,discountPrice:1}),[R,y]=u.useState(null),B=async()=>{v(!0);try{const s=await w.get(`${F}api/listing/userListing/${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(s.data.success===!1){console.log(s.data.message),y(s.data.message),n.error(s.data.message,{autoClose:m});return}f(s.data)}catch(s){console.log(s.message),n.error(s.message,{autoClose:m}),y(s.message)}finally{v(!1)}};u.useEffect(()=>{B()},[]);const E=async s=>{if(s.preventDefault(),!a.name||!a.description||!a.address||a.imageURLs.length===0){console.log("Fill out the form"),n.error("Please fill out the form",{autoClose:m});return}if(parseInt(a.discountPrice)>=parseInt(a.regularPrice)){n.success("Discount price can not be bigger than or equal to regular price",{autoClose:m});return}const r=localStorage.getItem("accessToken");try{g(!0);const l=await w.put(`${F}api/listing/${a._id}`,{...a,discountPrice:a.offer?a.discountPrice:0},{headers:{Authorization:`Bearer ${r}`}});if(l.data.succeess==!1){console.log(l.data.message),j(l.data.message),n.error(l.data.succeess,{autoClose:m});return}n.success("Listing updated successfully"),f(l.data.updatedListing),y(null)}catch(l){console.log(l.message),n.error(l.message,{autoClose:m})}finally{g(!1)}},W=s=>{f(r=>({...r,imageURLs:[...a.imageURLs.filter(l=>l!==s)]}))},o=s=>{s.target.name=="parking"||s.target.name=="furnished"||s.target.name=="offer"?f(r=>({...r,[s.target.name]:s.target.name=="parking"?!a.parking:s.target.name=="furnished"?!a.furnished:!a.offer})):f(r=>({...r,[s.target.name]:(s.target.type=="text",s.target.value)}))},_=s=>{s.target.files.length<7&&I(s.target.files)},A=()=>{if(x.length>0&&x.length+a.imageURLs.length<7){const r=[];console.log("upload photo"),g(!0);for(var s=0;s<x.length;s++)r.push($(x[s]));Promise.all(r).then(l=>{f(C=>({...C,imageURLs:a.imageURLs.concat(l)})),g(!0)}).then(()=>{j(!1)}).catch(l=>{n.error("image Upload failed.Image should be 2mb ",{autoClose:m}),console.log(l.message)}).finally(()=>{g(!1)})}else j("Please choose only six images for every list"),n.error("Please choose only six images for every list",{autoClose:m})},$=async s=>new Promise((r,l)=>{const C=Y(ee),q=s.name+new Date().getTime(),G=J(C,q),z=X(G,s);z.on("state_changed",i=>{const U=i.bytesTransferred/i.totalBytes*100;console.log(U),console.log("Upload is "+Math.round(U)+"% done")},i=>{console.log("eroro upload"),n.error(i.message,{autoClose:m}),console.log(i),g(!1),l(i)},()=>{console.log("down url"),Z(z.snapshot.ref).then(i=>{r(i),console.log(i)})})});return e.jsx(e.Fragment,{children:e.jsxs(se,{maxWidth:"md",sx:{paddingBottom:10},children:[e.jsx(u.Suspense,{fallback:e.jsx(K,{}),children:e.jsx(ae,{title:"Edit List"})}),T?e.jsx("h2",{children:"Loading..."}):R?e.jsx("h3",{children:R}):e.jsxs(L,{container:!0,spacing:t?0:1,justifyContent:t?"normal":"flex-start",children:[e.jsx(L,{item:!0,xs:12,md:6,children:e.jsxs(c,{component:"form",sx:{padding:2},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(d,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:a.name||"",onChange:o,required:!0,size:t?"small":"medium"}),e.jsx(d,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:a.description,onChange:o,required:!0,size:t?"small":"medium"}),e.jsx(d,{fullWidth:!0,maxRows:10,multiline:!0,type:"text",label:"address",variant:"outlined",name:"address",value:(a==null?void 0:a.address)||"",onChange:o,required:!0,size:t?"small":"medium"})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:{xs:"space-between",sm:"flex-start"}},children:[e.jsx(p,{value:"sell",label:"Sell",labelPlacement:"start",name:"type",onChange:o,control:e.jsx(h,{size:t?"small":"medium",checked:a.type==="sell"})}),e.jsx(p,{value:"rent",label:"Rent",labelPlacement:"start",name:"type",onChange:o,control:e.jsx(h,{size:t?"small":"medium",checked:a.type==="rent"})})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",flexDirection:{xs:"column",sm:"row"},alignItems:"flex-start",mb:1.5},children:[e.jsx(p,{value:!0,label:"Parking spot",labelPlacement:"start",name:"parking",onChange:o,control:e.jsx(h,{size:t?"small":"medium",checked:a.parking||!1})}),e.jsx(p,{value:!0,label:"Furnished",labelPlacement:"start",name:"furnished",onChange:o,control:e.jsx(h,{size:t?"small":"medium",checked:a.furnished||!1})}),e.jsx(p,{value:!0,label:"Offer",labelPlacement:"start",name:"offer",onChange:o,control:e.jsx(h,{size:t?"small":"medium",checked:a.offer||!1})})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"flex-start",gap:3,flexWrap:"wrap"},children:[e.jsx(d,{type:"number",label:"Beds",size:t?"small":"medium",name:"bedrooms",value:a.bedrooms,onChange:o}),e.jsx(d,{type:"number",label:"Baths",size:t?"small":"medium",name:"bath",value:a.bath,onChange:o}),e.jsx(d,{type:"number",label:"Regular Price / month",size:t?"small":"medium",name:"regularPrice",value:a.regularPrice,onChange:o}),a.offer&&e.jsx(d,{type:"number",label:"Discount Price / month",size:t?"small":"medium",name:"discountPrice",value:a.discountPrice,onChange:o})]})]})}),e.jsxs(L,{item:!0,xs:12,md:6,sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(c,{children:[e.jsxs("h3",{style:{fontSize:t?"16.5px":"20px",fontWeight:"bolder",textAlign:"justify"},children:["Images:",e.jsx("span",{style:{color:Q},children:"The first image will be the cover (maximum:6)"})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"flex-start",flexWrap:"wrap",gap:1.5},children:[e.jsx("input",{style:{border:"1p solid aqua",outline:"2px solid",outlineColor:V,textIndent:"4px"},type:"file",accept:"image/*",multiple:!0,onChange:_}),e.jsx(P,{onClick:A,variant:"contained",color:"success",size:t?"small":"large",disabled:b,fullWidth:!0,children:b?"Uploading....":"UPLOAD"})]})]}),e.jsxs(c,{className:"show image section",children:[e.jsx("p",{children:k&&k}),a.imageURLs.length>0&&a.imageURLs.map((s,r)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx("img",{width:"100",height:"100",style:{borderRadius:"5px",objectFit:"cotain"},src:s,alt:s}),e.jsx(P,{onClick:()=>{W(s)},variant:"text",color:"warning",children:"Delete"})]},r))]}),e.jsx(P,{type:"submit",onClick:E,variant:"contained",fullWidth:!0,size:t?"small":"large",color:"success",disabled:!!b,children:b?"Loading":"Edit List"})]})]})]})})};export{fe as default};
