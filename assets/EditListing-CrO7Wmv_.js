function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/WaveHeader-GOCtbZ2g.js","assets/index-RV5YIsxB.js","assets/index-DDnostVl.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as m,_ as V,p as H,u as M,b as Q,V as Y,j as e,F as J,T as c,S as K,B as X,a as U,w as Z,U as ee,v as i,$ as se}from"./index-RV5YIsxB.js";import{g as re,r as te,u as ae,a as ie}from"./index.esm2017-xdxYMBNT.js";import{a as ne}from"./firebase-Dc1fJsNB.js";import{A as y,a as v,d as P,b as R}from"./ExpandMore-CR451P-6.js";import{a as le}from"./axiosConfig-CWlSV8Gi.js";import{C as oe}from"./Container-BPfE54Zb.js";import{G as a}from"./Grid-DGzFf4fj.js";import{T as x}from"./TextField-CP7HvCbv.js";import{R as ce,a as I,F as de}from"./RadioGroup-C92KUvlz.js";import{F as f}from"./FormControlLabel-CLuHO4QX.js";import{C as F}from"./Checkbox-AbB0sQZ5.js";import"./useSlot-Bsk3VM8j.js";import"./Collapse-DCJMqTj9.js";import"./styled-DolKx1nG.js";import"./useFormControl-x1edabWd.js";import"./List-Clvs1NRc.js";import"./Stack-KQcwQfyK.js";m.lazy(()=>V(()=>import("./WaveHeader-GOCtbZ2g.js"),__vite__mapDeps([0,1,2])));const Fe=()=>{const T=H(),[j,B]=m.useState([]),[w,C]=m.useState(),[b,g]=m.useState(!1),E=M(),k=Q(E.breakpoints.down("md")),{listingId:z}=Y(),[_,W]=m.useState(!1),[s,p]=m.useState({type:"rent",description:"",imageURLs:[],parking:!1,furnished:!1,offer:!1,bedrooms:"",bath:"",regularPrice:"",discountPrice:""}),[S,L]=m.useState(null),N=async()=>{W(!0);try{const r=await Z.get(`${ee}api/listing/userListing/${z}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(r.data.success===!1){L(r.data.message),i.error(r.data.message);return}p(r.data)}catch(r){i.error(r.message),L(r.message)}finally{W(!1)}};m.useEffect(()=>{N()},[]);const A=async r=>{if(r.preventDefault(),!s.name||!s.description||!s.address||s.imageURLs.length===0){i.error("Please provide the required information");return}const t=parseFloat(s.bedrooms),o=parseFloat(s.bath),d=parseFloat(s.regularPrice),h=parseFloat(s.discountPrice);if(isNaN(t)||t<=0){i.error("Beds must be greater than zero");return}if(isNaN(o)||o<=0){i.error("Bath must be greater than zero");return}if(isNaN(d)||d<=0){i.error("Price must be greater than zero");return}if(s.offer){if(isNaN(h)||h<=0){i.error("Discount price must be greater than zero");return}if(h>=d){i.error("Discount must be smaller than the regular price");return}}try{g(!0);const n=await le.put(`api/listing/${s._id}`,{...s,discountPrice:s.offer?s.discountPrice:0});if(n.data.succeess==!1){C(n.data.message),i.error(n.data.succeess);return}i.success("Listing updated successfully"),T(`/listing/${z+","+se}`),L(null)}catch(n){i.error(n.message)}finally{g(!1)}},$=r=>{p(t=>({...t,imageURLs:[...s.imageURLs.filter(o=>o!==r)]}))},l=m.useCallback(r=>{const{name:t,type:o,value:d,checked:h}=r.target;if(o==="checkbox"){t=="type"?p(n=>({...n,[t]:d})):p(n=>({...n,[t]:h}));return}p(n=>({...n,[t]:d}))},[]),G=r=>{r.target.files.length<7&&B(r.target.files)},q=()=>{if(j.length>0&&j.length+s.imageURLs.length<7){const t=[];console.log("upload photo"),g(!0);for(var r=0;r<j.length;r++)t.push(O(j[r]));Promise.all(t).then(o=>{p(d=>({...d,imageURLs:s.imageURLs.concat(o)})),g(!0)}).then(()=>{C(!1)}).catch(o=>{i.error("image Upload failed.Image should be 2mb ")}).finally(()=>{g(!1)})}else C("Please choose only six images for every list"),i.error("Please choose only six images for every list")},O=async r=>new Promise((t,o)=>{const d=re(ne),h=r.name+new Date().getTime(),n=te(d,h),D=ae(n,r);D.on("state_changed",u=>{u.bytesTransferred/u.totalBytes*100},u=>{i.error(u.message),console.log(u),g(!1),o(u)},()=>{ie(D.snapshot.ref).then(u=>{t(u)})})});return e.jsx(e.Fragment,{children:e.jsxs(oe,{maxWidth:"lg",sx:{pb:5},children:[e.jsx(m.Suspense,{fallback:e.jsx(J,{}),children:e.jsx(c,{variant:"h4",fontWeight:"bold",mb:3,children:"Edit Listing"})}),_?e.jsx(c,{variant:"h4",textAlign:"center",mt:4,children:e.jsx("fallback",{})}):S?e.jsx(c,{variant:"h5",color:"error",textAlign:"center",mt:4,children:S}):e.jsx(a,{container:!0,spacing:4,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(K,{elevation:2,sx:{p:2,borderRadius:2,maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs(y,{defaultExpanded:!0,children:[e.jsx(v,{expandIcon:e.jsx(P,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"General Info"})}),e.jsx(R,{children:e.jsxs(X,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(x,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:s.name||"",onChange:l,required:!0,size:k?"small":"medium"}),e.jsx(x,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:s.description||"",onChange:l,required:!0,size:k?"small":"medium"}),e.jsx(x,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Address",variant:"outlined",name:"address",value:s.address||"",onChange:l,required:!0,size:k?"small":"medium"})]})})]}),e.jsxs(y,{children:[e.jsx(v,{expandIcon:e.jsx(P,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Property Details"})}),e.jsx(R,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle1",fontWeight:500,mb:1,children:"Type"}),e.jsxs(ce,{row:!0,name:"type",value:s.type,onChange:l,sx:{flexWrap:"wrap"},children:[e.jsx(f,{value:"sell",control:e.jsx(I,{size:"small"}),label:"Sell",sx:{mr:2}}),e.jsx(f,{value:"rent",control:e.jsx(I,{size:"small"}),label:"Rent",sx:{mr:2}})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle1",fontWeight:500,mb:1,children:"Options"}),e.jsxs(de,{row:!0,sx:{flexWrap:"wrap"},children:[e.jsx(f,{control:e.jsx(F,{size:"small",checked:s.parking||!1,onChange:l,name:"parking"}),label:"Parking Spot",sx:{mr:2}}),e.jsx(f,{control:e.jsx(F,{size:"small",checked:s.furnished||!1,onChange:l,name:"furnished"}),label:"Furnished",sx:{mr:2}})]})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Beds",type:"number",name:"bedrooms",value:s.bedrooms,onChange:l,size:"small"})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Baths",type:"number",name:"bath",value:s.bath,onChange:l,size:"small"})})]})})]}),e.jsxs(y,{children:[e.jsx(v,{expandIcon:e.jsx(P,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Pricing"})}),e.jsx(R,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(f,{control:e.jsx(F,{checked:s.offer||!1,onChange:l,name:"offer"}),label:"This listing has an offer"})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(x,{fullWidth:!0,label:"Regular Price",type:"number",name:"regularPrice",value:s.regularPrice,onChange:l,size:"small"})}),s.offer&&e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(x,{fullWidth:!0,label:"Discount Price",type:"number",name:"discountPrice",value:s.discountPrice,onChange:l,size:"small",color:"success"})})]})})]}),e.jsxs(y,{children:[e.jsx(v,{expandIcon:e.jsx(P,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Upload Images"})}),e.jsxs(R,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",mb:2,children:"The first image will be the cover (maximum: 6)"}),e.jsxs(a,{container:!0,spacing:2,mb:2,children:[e.jsx(a,{item:!0,xs:12,sm:8,children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:G,style:{width:"100%"}})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(U,{fullWidth:!0,variant:"contained",color:"success",onClick:q,disabled:b,children:b?"Uploading...":"Upload"})})]}),w&&e.jsx(c,{color:"error",variant:"body2",mb:2,children:w}),e.jsx(a,{container:!0,spacing:2,mb:2,children:s.imageURLs.map((r,t)=>e.jsxs(a,{item:!0,xs:12,sm:6,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx("img",{src:r,alt:`uploaded-${t}`,style:{width:100,height:100,borderRadius:5,objectFit:"contain"}}),e.jsx(U,{variant:"text",color:"error",onClick:()=>$(r),children:"Delete"})]},t))})]})]}),e.jsx(U,{variant:"contained",color:"success",onClick:A,disabled:b,sx:{mt:4,width:{xs:"100%",sm:"auto"},px:4,py:1.5,fontSize:{xs:"0.9rem",sm:"1rem"},alignSelf:"center",display:"block",mx:{sm:"auto"}},children:b?"Loading...":"Update Listing"})]})})})]})})};export{Fe as default};
