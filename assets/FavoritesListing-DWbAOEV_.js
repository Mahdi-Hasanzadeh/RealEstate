import{j as t,B as h,T as x,r as o,y as E,x as N,b as g,U as f,A as u}from"./index-BTe4GArI.js";import{L as T}from"./createSvgIcon-Dye2LVBh.js";import{N as W,d as _,I as z}from"./ItemCard-e8CUoWnt.js";import{d as D}from"./ErrorOutline-Dj1ABduq.js";import{C as R}from"./ConfirmDialog-5tg7-0iW.js";import{C as n}from"./Container-CSPSROeH.js";import"./isMuiElement-DIt3a8Dx.js";import"./Card-Byf1yaOd.js";import"./CardMedia-qNnUd2Z2.js";import"./Zoom-BQjlFhF1.js";import"./styled-fWTeZ0ma.js";const U=({error:l})=>t.jsxs(h,{sx:{minHeight:"50vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",color:"error.main",px:2},children:[t.jsx(D,{sx:{fontSize:80,mb:2}}),t.jsx(x,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Something went wrong"}),t.jsx(x,{variant:"body1",children:l})]}),X=()=>{const[l,c]=o.useState(!1),[r,j]=o.useState(null),[C,p]=o.useState(!1),[S,d]=o.useState(null),[v,m]=o.useState([]),y=E(e=>e.persistData.user.userInfo),$=N(),w=()=>c(!1),I=()=>{r!=null&&r.id&&(k(r.id),c(!1))},F=e=>{j({id:e._id,name:e.name}),c(!0)},b=e=>{const s=`/listing/${e._id},${e.mainCategoryName},${e.subCategoryName||"null"}`;$(s)},L=async()=>{var e;p(!0);try{const{data:s}=await g.get(`${f}api/user/userInfo/${y.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!((e=s==null?void 0:s.favorites)!=null&&e.length)){m([]),d(null);return}const i=s.favorites.join(","),{data:a}=await g.get(`${f}api/listing/favoriteListings?ListingsId=${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});m(a),d(null)}catch(s){d(s.message||"Something went wrong."),u.error(s.message||"Failed to fetch favorites.")}finally{p(!1)}},k=async e=>{var s,i;try{if(!(await g.put(`${f}api/user/update/${y.id}`,{favorites:e,removeFavorites:!0},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data)throw new Error("Failed to remove from favorites.");u.success("Removed from favorites."),m(A=>A.filter(B=>B._id!==e))}catch(a){u.error(((i=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:i.message)||a.message,{autoClose:3e3})}};return o.useEffect(()=>{L()},[]),C?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh",children:t.jsx(T,{})})}):S?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(U,{})}):v.length===0?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(W,{message:"No Favorites",description:"You havenâ€™t saved anything yet.",icon:t.jsx(_,{sx:{fontSize:80,color:"grey.500",mb:2}})})}):t.jsxs(n,{maxWidth:"lg",sx:{pb:6},children:[t.jsx(x,{variant:"h5",align:"center",sx:{color:"green",mb:4},children:"Your Favorites"}),t.jsx(h,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:3,p:2,pb:8},children:v.map((e,s)=>t.jsx(z,{item:e,onDeleteClick:()=>F(e),showView:!0,onViewClick:b},e._id||s))}),t.jsx(R,{open:l,title:"Warning",message:`Are you sure to delete listing (${r==null?void 0:r.name})?`,onClose:w,onConfirm:I,cancelText:"Disagree",confirmText:"Agree"})]})};export{X as default};
