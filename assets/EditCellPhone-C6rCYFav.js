import{a1 as O,y as X,r as n,u as ee,b as re,am as k,S as M,an as W,Q as B,j as e,F as T,T as l,Z as ae,B as se,a as U,v as i,c as E,d as te,f as oe}from"./index-B6Jh5Kqf.js";import{d as b}from"./ExpandMore-BChtarB8.js";import{a as ie}from"./firebase-ZV_pIUqm.js";import{g as ne,r as le,u as ce,a as de}from"./index.esm2017-C0yvW6Ps.js";import v from"./ComboBox-CaZcAueG.js";import{C as me}from"./Container-Dhm7lGM3.js";import{G as t}from"./Grid-DmWEdVJA.js";import{A as y,a as P,b as C}from"./AccordionSummary-YeURJE3v.js";import{T as g}from"./TextField-CLAyp7H7.js";import{F as ue}from"./FormControlLabel-Cgyp2Sx4.js";import{C as he}from"./Checkbox-DCCZkWUy.js";import"./MenuItem-IBCsPEo0.js";import"./List-DmmOO-O2.js";import"./dividerClasses-CG4fMOhk.js";import"./listItemTextClasses-XLtkYeRm.js";import"./styled-lc6bJm8w.js";import"./react-is.production.min-DUDD-a5e.js";import"./Collapse-ChMWxjAG.js";import"./FormLabel-BWInThNm.js";import"./useFormControl-CrCWuu7o.js";import"./Stack-DzziobC3.js";import"./SwitchBase-K1iBrzst.js";const Be=()=>{const{listingId:R}=O(),V=X(),[x,z]=n.useState([]),[A,D]=n.useState(),[p,m]=n.useState(!1),N=ee(),S=re(N.breakpoints.down("md")),[q,L]=n.useState(!1),[w,$]=n.useState(null),[s,f]=n.useState({name:"",description:"",address:"",imageURLs:[],regularPrice:"",discountPrice:"",offer:!1}),[h,I]=n.useState({brand:k[1].value,storage:M[0].value,color:W[0].value,RAM:B[0].value}),u=r=>{f(a=>({...a,[r.target.name]:r.target.type=="checkbox"?r.target.checked:r.target.value}))},j=r=>{I(a=>({...a,[r.target.name]:r.target.value}))},G=async r=>{if(r.preventDefault(),!s.name||!s.description||!s.address||s.imageURLs.length===0){i.error("Please provide the required information");return}const a=parseFloat(s.regularPrice),o=parseFloat(s.discountPrice);if(isNaN(a)||a<=0){i.error("Price must be greater than zero");return}if(s.offer){if(isNaN(o)||o<=0){i.error("Discount price must be greater than zero");return}if(o>=a){i.error("Discount must be smaller than the regular price");return}}try{m(!0);const c={...s,...h,discountPrice:s.offer?s.discountPrice:0};await E.put(`api/listing/cellPhone/${R}`,c),i.success("Product Updated Successfully"),V(`/listing/${R+","+te+","+oe}`)}catch(c){i.error(c.message)}finally{m(!1)}},Q=r=>{f(a=>({...a,imageURLs:[...s.imageURLs.filter(o=>o!==r)]}))},_=r=>{r.target.files.length<7&&z(r.target.files)},H=()=>{if(x.length>0&&x.length+s.imageURLs.length<7){const a=[];console.log("upload photo"),m(!0);for(var r=0;r<x.length;r++)a.push(Y(x[r]));Promise.all(a).then(o=>{f(c=>({...c,imageURLs:s.imageURLs.concat(o)})),m(!0)}).then(()=>{D(!1)}).catch(o=>{i.error("image Upload failed.Image should be 2mb "),console.log(o.message)}).finally(()=>{m(!1)})}else D("Please choose only six images for every list"),i.error("Please choose only six images for every list")},Y=async r=>new Promise((a,o)=>{const c=ne(ie),J=r.name+new Date().getTime(),K=le(c,J),F=ce(K,r);F.on("state_changed",d=>{d.bytesTransferred/d.totalBytes*100},d=>{i.error(d.message),m(!1),o(d)},()=>{console.log("down url"),de(F.snapshot.ref).then(d=>{a(d)})})}),Z=async()=>{L(!0);try{const r=await E.get(`api/listing/cellPhone/${R}`);console.log(r.data);const a=r.data.data;f({name:a.name,description:a.description,address:a.address,imageURLs:a.imageURLs,regularPrice:a.regularPrice,discountPrice:a.discountPrice,offer:a.offer}),I({brand:a.brand,storage:a.storage,color:a.color,RAM:a.RAM})}catch(r){i.error(r.message),$(r.message)}finally{L(!1)}};return n.useEffect(()=>{Z()},[]),e.jsx(e.Fragment,{children:e.jsxs(me,{maxWidth:"lg",sx:{paddingBottom:10},children:[e.jsx(n.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(l,{variant:"h4",fontWeight:"bold",mb:3,children:"Edit Listing"})}),q?e.jsx(l,{variant:"h4",textAlign:"center",mt:4,children:e.jsx(T,{})}):w?e.jsx(l,{variant:"h5",color:"error",textAlign:"center",mt:4,children:w}):e.jsxs(t,{container:!0,spacing:4,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(ae,{elevation:2,sx:{p:2,borderRadius:2,maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs(y,{defaultExpanded:!0,children:[e.jsx(P,{expandIcon:e.jsx(b,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"General Info"})}),e.jsx(C,{children:e.jsxs(se,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(g,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:s.name||"",onChange:u,required:!0,size:S?"small":"medium"}),e.jsx(g,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:s.description||"",onChange:u,required:!0,size:S?"small":"medium"}),e.jsx(g,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Address",variant:"outlined",name:"address",value:s.address||"",onChange:u,required:!0,size:S?"small":"medium"})]})})]}),e.jsxs(y,{sx:{overflow:"hidden",bgcolor:"background.paper"},children:[e.jsx(P,{expandIcon:e.jsx(b,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Device Details"})}),e.jsx(C,{sx:{px:3,py:2},children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(v,{label:"Brand",name:"brand",defaultValue:"Samsung",value:h.brand,items:k.filter(r=>r.name!="ALL BRANDS"),handleValueMethod:j})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(v,{label:"Storage",name:"storage",defaultValue:"Choose Storage",value:h.storage,items:M,handleValueMethod:j})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(v,{label:"RAM",name:"RAM",defaultValue:"Choose RAM",value:h.RAM,items:B,handleValueMethod:j})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(v,{label:"Color",name:"color",defaultValue:"Choose Color",value:h.color,items:W,handleValueMethod:j})})]})})]}),e.jsxs(y,{children:[e.jsx(P,{expandIcon:e.jsx(b,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Pricing"})}),e.jsx(C,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(ue,{control:e.jsx(he,{checked:s.offer||!1,onChange:u,name:"offer"}),label:"This listing has an offer"})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(g,{fullWidth:!0,label:"Regular Price",type:"number",name:"regularPrice",value:s.regularPrice,onChange:u,size:"small"})}),s.offer&&e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(g,{fullWidth:!0,label:"Discount Price",type:"number",name:"discountPrice",value:s.discountPrice,onChange:u,size:"small",color:"success"})})]})})]}),e.jsxs(y,{children:[e.jsx(P,{expandIcon:e.jsx(b,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Upload Images"})}),e.jsxs(C,{children:[e.jsx(l,{variant:"body2",color:"text.secondary",mb:2,children:"The first image will be the cover (maximum: 6)"}),e.jsxs(t,{container:!0,spacing:2,mb:2,children:[e.jsx(t,{item:!0,xs:12,sm:8,children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:_,style:{width:"100%"}})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsx(U,{fullWidth:!0,variant:"contained",color:"success",onClick:H,disabled:p,children:p?"Uploading...":"Upload"})})]}),A&&e.jsx(l,{color:"error",variant:"body2",mb:2,children:A}),e.jsx(t,{container:!0,spacing:2,mb:2,children:s.imageURLs.map((r,a)=>e.jsxs(t,{item:!0,xs:12,sm:6,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx("img",{src:r,alt:`uploaded-${a}`,style:{width:100,height:100,borderRadius:5,objectFit:"contain"}}),e.jsx(U,{variant:"text",color:"error",onClick:()=>Q(r),children:"Delete"})]},a))})]})]}),e.jsx(U,{variant:"contained",color:"success",onClick:G,disabled:p,sx:{mt:4,width:{xs:"100%",sm:"auto"},px:4,py:1.5,fontSize:{xs:"0.9rem",sm:"1rem"},alignSelf:"center",display:"block",mx:{sm:"auto"}},children:p?"Loading...":"Update"})]})}),e.jsx(t,{item:!0,xs:12})]})]})})};export{Be as default};
