import{y as O,r as m,u as Q,b as Y,a1 as Z,j as e,F as I,T as c,Z as J,B as K,a as F,C as V,U as X,v as i,c as ee,e as se}from"./index-B6Jh5Kqf.js";import{g as re,r as te,u as ae,a as ie}from"./index.esm2017-C0yvW6Ps.js";import{a as ne}from"./firebase-ZV_pIUqm.js";import{d as y}from"./ExpandMore-BChtarB8.js";import{C as oe}from"./Container-Dhm7lGM3.js";import{G as a}from"./Grid-DmWEdVJA.js";import{A as v,a as C,b as P}from"./AccordionSummary-YeURJE3v.js";import{T as x}from"./TextField-CLAyp7H7.js";import{R as le,a as T,F as ce}from"./RadioGroup-CJEdl4IK.js";import{F as f}from"./FormControlLabel-Cgyp2Sx4.js";import{C as L}from"./Checkbox-DCCZkWUy.js";import"./styled-lc6bJm8w.js";import"./react-is.production.min-DUDD-a5e.js";import"./Collapse-ChMWxjAG.js";import"./FormLabel-BWInThNm.js";import"./useFormControl-CrCWuu7o.js";import"./List-DmmOO-O2.js";import"./SwitchBase-K1iBrzst.js";import"./Stack-DzziobC3.js";const We=()=>{const B=O(),[j,N]=m.useState([]),[W,R]=m.useState(),[b,g]=m.useState(!1),E=Q(),k=Y(E.breakpoints.down("md")),{listingId:w}=Z(),[A,z]=m.useState(!1),[s,p]=m.useState({type:"rent",description:"",imageURLs:[],parking:!1,furnished:!1,offer:!1,bedrooms:"",bath:"",regularPrice:"",discountPrice:""}),[S,U]=m.useState(null),$=async()=>{z(!0);try{const r=await V.get(`${X}api/listing/userListing/${w}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(r.data.success===!1){U(r.data.message),i.error(r.data.message);return}p(r.data)}catch(r){i.error(r.message),U(r.message)}finally{z(!1)}};m.useEffect(()=>{$()},[]);const G=async r=>{if(r.preventDefault(),!s.name||!s.description||!s.address||s.imageURLs.length===0){i.error("Please provide the required information");return}const t=parseFloat(s.bedrooms),l=parseFloat(s.bath),d=parseFloat(s.regularPrice),h=parseFloat(s.discountPrice);if(isNaN(t)||t<=0){i.error("Beds must be greater than zero");return}if(isNaN(l)||l<=0){i.error("Bath must be greater than zero");return}if(isNaN(d)||d<=0){i.error("Price must be greater than zero");return}if(s.offer){if(isNaN(h)||h<=0){i.error("Discount price must be greater than zero");return}if(h>=d){i.error("Discount must be smaller than the regular price");return}}try{g(!0);const n=await ee.put(`api/listing/${s._id}`,{...s,discountPrice:s.offer?s.discountPrice:0});if(n.data.succeess==!1){R(n.data.message),i.error(n.data.succeess);return}i.success("Listing updated successfully"),B(`/listing/${w+","+se}`),U(null)}catch(n){i.error(n.message)}finally{g(!1)}},q=r=>{p(t=>({...t,imageURLs:[...s.imageURLs.filter(l=>l!==r)]}))},o=m.useCallback(r=>{const{name:t,type:l,value:d,checked:h}=r.target;if(l==="checkbox"){t=="type"?p(n=>({...n,[t]:d})):p(n=>({...n,[t]:h}));return}p(n=>({...n,[t]:d}))},[]),_=r=>{r.target.files.length<7&&N(r.target.files)},H=()=>{if(j.length>0&&j.length+s.imageURLs.length<7){const t=[];console.log("upload photo"),g(!0);for(var r=0;r<j.length;r++)t.push(M(j[r]));Promise.all(t).then(l=>{p(d=>({...d,imageURLs:s.imageURLs.concat(l)})),g(!0)}).then(()=>{R(!1)}).catch(l=>{i.error("image Upload failed.Image should be 2mb ")}).finally(()=>{g(!1)})}else R("Please choose only six images for every list"),i.error("Please choose only six images for every list")},M=async r=>new Promise((t,l)=>{const d=re(ne),h=r.name+new Date().getTime(),n=te(d,h),D=ae(n,r);D.on("state_changed",u=>{u.bytesTransferred/u.totalBytes*100},u=>{i.error(u.message),console.log(u),g(!1),l(u)},()=>{ie(D.snapshot.ref).then(u=>{t(u)})})});return e.jsx(e.Fragment,{children:e.jsxs(oe,{maxWidth:"lg",sx:{pb:5},children:[e.jsx(m.Suspense,{fallback:e.jsx(I,{}),children:e.jsx(c,{variant:"h4",fontWeight:"bold",mb:3,children:"Edit Listing"})}),A?e.jsx(c,{variant:"h4",textAlign:"center",mt:4,children:e.jsx(I,{})}):S?e.jsx(c,{variant:"h5",color:"error",textAlign:"center",mt:4,children:S}):e.jsx(a,{container:!0,spacing:4,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(J,{elevation:2,sx:{p:2,borderRadius:2,maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs(v,{defaultExpanded:!0,children:[e.jsx(C,{expandIcon:e.jsx(y,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"General Info"})}),e.jsx(P,{children:e.jsxs(K,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(x,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:s.name||"",onChange:o,required:!0,size:k?"small":"medium"}),e.jsx(x,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:s.description||"",onChange:o,required:!0,size:k?"small":"medium"}),e.jsx(x,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Address",variant:"outlined",name:"address",value:s.address||"",onChange:o,required:!0,size:k?"small":"medium"})]})})]}),e.jsxs(v,{children:[e.jsx(C,{expandIcon:e.jsx(y,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Property Details"})}),e.jsx(P,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle1",fontWeight:500,mb:1,children:"Type"}),e.jsxs(le,{row:!0,name:"type",value:s.type,onChange:o,sx:{flexWrap:"wrap"},children:[e.jsx(f,{value:"sell",control:e.jsx(T,{size:"small"}),label:"Sell",sx:{mr:2}}),e.jsx(f,{value:"rent",control:e.jsx(T,{size:"small"}),label:"Rent",sx:{mr:2}})]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle1",fontWeight:500,mb:1,children:"Options"}),e.jsxs(ce,{row:!0,sx:{flexWrap:"wrap"},children:[e.jsx(f,{control:e.jsx(L,{size:"small",checked:s.parking||!1,onChange:o,name:"parking"}),label:"Parking Spot",sx:{mr:2}}),e.jsx(f,{control:e.jsx(L,{size:"small",checked:s.furnished||!1,onChange:o,name:"furnished"}),label:"Furnished",sx:{mr:2}})]})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Beds",type:"number",name:"bedrooms",value:s.bedrooms,onChange:o,size:"small"})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Baths",type:"number",name:"bath",value:s.bath,onChange:o,size:"small"})})]})})]}),e.jsxs(v,{children:[e.jsx(C,{expandIcon:e.jsx(y,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Pricing"})}),e.jsx(P,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(f,{control:e.jsx(L,{checked:s.offer||!1,onChange:o,name:"offer"}),label:"This listing has an offer"})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(x,{fullWidth:!0,label:"Regular Price",type:"number",name:"regularPrice",value:s.regularPrice,onChange:o,size:"small"})}),s.offer&&e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(x,{fullWidth:!0,label:"Discount Price",type:"number",name:"discountPrice",value:s.discountPrice,onChange:o,size:"small",color:"success"})})]})})]}),e.jsxs(v,{children:[e.jsx(C,{expandIcon:e.jsx(y,{}),children:e.jsx(c,{variant:"h6",fontWeight:500,children:"Upload Images"})}),e.jsxs(P,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",mb:2,children:"The first image will be the cover (maximum: 6)"}),e.jsxs(a,{container:!0,spacing:2,mb:2,children:[e.jsx(a,{item:!0,xs:12,sm:8,children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:_,style:{width:"100%"}})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(F,{fullWidth:!0,variant:"contained",color:"success",onClick:H,disabled:b,children:b?"Uploading...":"Upload"})})]}),W&&e.jsx(c,{color:"error",variant:"body2",mb:2,children:W}),e.jsx(a,{container:!0,spacing:2,mb:2,children:s.imageURLs.map((r,t)=>e.jsxs(a,{item:!0,xs:12,sm:6,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx("img",{src:r,alt:`uploaded-${t}`,style:{width:100,height:100,borderRadius:5,objectFit:"contain"}}),e.jsx(F,{variant:"text",color:"error",onClick:()=>q(r),children:"Delete"})]},t))})]})]}),e.jsx(F,{variant:"contained",color:"success",onClick:G,disabled:b,sx:{mt:4,width:{xs:"100%",sm:"auto"},px:4,py:1.5,fontSize:{xs:"0.9rem",sm:"1rem"},alignSelf:"center",display:"block",mx:{sm:"auto"}},children:b?"Loading...":"Update Listing"})]})})})]})})};export{We as default};
