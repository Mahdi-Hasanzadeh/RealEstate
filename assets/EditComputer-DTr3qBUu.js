import{a1 as J,y as K,r as n,u as X,b as ee,ad as k,a0 as M,$ as W,j as e,F as B,T as l,Z as re,B as te,a as U,v as o,c as E,d as se,g as ae}from"./index-B6Jh5Kqf.js";import{d as j}from"./ExpandMore-BChtarB8.js";import{a as ie}from"./firebase-ZV_pIUqm.js";import{g as oe,r as ne,u as le,a as ce}from"./index.esm2017-C0yvW6Ps.js";import D from"./ComboBox-CaZcAueG.js";import{C as de}from"./Container-Dhm7lGM3.js";import{G as a}from"./Grid-DmWEdVJA.js";import{A as b,a as v,b as y}from"./AccordionSummary-YeURJE3v.js";import{T as h}from"./TextField-CLAyp7H7.js";import{F as me}from"./FormControlLabel-Cgyp2Sx4.js";import{C as ue}from"./Checkbox-DCCZkWUy.js";import"./MenuItem-IBCsPEo0.js";import"./List-DmmOO-O2.js";import"./dividerClasses-CG4fMOhk.js";import"./listItemTextClasses-XLtkYeRm.js";import"./styled-lc6bJm8w.js";import"./react-is.production.min-DUDD-a5e.js";import"./Collapse-ChMWxjAG.js";import"./FormLabel-BWInThNm.js";import"./useFormControl-CrCWuu7o.js";import"./Stack-DzziobC3.js";import"./SwitchBase-K1iBrzst.js";const We=()=>{const{listingId:R}=J(),T=K(),[g,z]=n.useState([]),[L,S]=n.useState(),[p,m]=n.useState(!1),N=X(),P=ee(N.breakpoints.down("md")),[V,A]=n.useState(!1),[w,q]=n.useState(null),[s,x]=n.useState({name:"",description:"",address:"",imageURLs:[],regularPrice:"",discountPrice:"",offer:!1}),[f,I]=n.useState({brand:k[1].value,storage:M[0].value,RAM:W[0].value}),u=r=>{x(t=>({...t,[r.target.name]:r.target.type=="checkbox"?r.target.checked:r.target.value}))},C=r=>{I(t=>({...t,[r.target.name]:r.target.value}))},$=async r=>{if(r.preventDefault(),!s.name||!s.description||!s.address||s.imageURLs.length===0){o.error("Please provide the required information");return}const t=parseFloat(s.regularPrice),i=parseFloat(s.discountPrice);if(isNaN(t)||t<=0){o.error("Price must be greater than zero");return}if(s.offer){if(isNaN(i)||i<=0){o.error("Discount price must be greater than zero");return}if(i>=t){o.error("Discount must be smaller than the regular price");return}}try{m(!0);const c={...s,...f,discountPrice:s.offer?s.discountPrice:0};await E.put(`api/listing/computer/${R}`,c),o.success("Product Updated Successfully"),T(`/listing/${R+","+se+","+ae}`)}catch(c){o.error(c.message)}finally{m(!1)}},G=r=>{x(t=>({...t,imageURLs:[...s.imageURLs.filter(i=>i!==r)]}))},O=r=>{r.target.files.length<7&&z(r.target.files)},_=()=>{if(g.length>0&&g.length+s.imageURLs.length<7){const t=[];console.log("upload photo"),m(!0);for(var r=0;r<g.length;r++)t.push(H(g[r]));Promise.all(t).then(i=>{x(c=>({...c,imageURLs:s.imageURLs.concat(i)})),m(!0)}).then(()=>{S(!1)}).catch(i=>{o.error("image Upload failed.Image should be 2mb "),console.log(i.message)}).finally(()=>{m(!1)})}else S("Please choose only six images for every list"),o.error("Please choose only six images for every list")},H=async r=>new Promise((t,i)=>{const c=oe(ie),Y=r.name+new Date().getTime(),Z=ne(c,Y),F=le(Z,r);F.on("state_changed",d=>{d.bytesTransferred/d.totalBytes*100},d=>{o.error(d.message),m(!1),i(d)},()=>{console.log("down url"),ce(F.snapshot.ref).then(d=>{t(d)})})}),Q=async()=>{A(!0);try{const t=(await E.get(`api/listing/computer/${R}`)).data.data;x({name:t.name,description:t.description,address:t.address,imageURLs:t.imageURLs,regularPrice:t.regularPrice,discountPrice:t.discountPrice,offer:t.offer}),I({brand:t.brand,storage:t.storage,RAM:t.RAM})}catch(r){o.error(r.message),q(r.message)}finally{A(!1)}};return n.useEffect(()=>{Q()},[]),e.jsx(e.Fragment,{children:e.jsxs(de,{maxWidth:"lg",sx:{paddingBottom:10},children:[e.jsx(n.Suspense,{fallback:e.jsx(B,{}),children:e.jsx(l,{variant:"h4",fontWeight:"bold",mb:3,children:"Edit Listing"})}),V?e.jsx(l,{variant:"h4",textAlign:"center",mt:4,children:e.jsx(B,{})}):w?e.jsx(l,{variant:"h5",color:"error",textAlign:"center",mt:4,children:w}):e.jsx(a,{container:!0,spacing:4,children:e.jsx(a,{item:!0,xs:12,children:e.jsxs(re,{elevation:2,sx:{p:2,borderRadius:2,maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs(b,{defaultExpanded:!0,children:[e.jsx(v,{expandIcon:e.jsx(j,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"General Info"})}),e.jsx(y,{children:e.jsxs(te,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(h,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:s.name||"",onChange:u,required:!0,size:P?"small":"medium"}),e.jsx(h,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:s.description||"",onChange:u,required:!0,size:P?"small":"medium"}),e.jsx(h,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Address",variant:"outlined",name:"address",value:s.address||"",onChange:u,required:!0,size:P?"small":"medium"})]})})]}),e.jsxs(b,{sx:{overflow:"hidden",bgcolor:"background.paper"},children:[e.jsx(v,{expandIcon:e.jsx(j,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Device Details"})}),e.jsx(y,{sx:{px:3,py:2},children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Brand",name:"brand",defaultValue:"DELL",value:f.brand,items:k.filter(r=>r.name!="ALL BRANDS"),handleValueMethod:C})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"Storage",name:"storage",defaultValue:"Choose Storage",value:f.storage,items:M,handleValueMethod:C})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(D,{label:"RAM",name:"RAM",defaultValue:"Choose RAM",value:f.RAM,items:W,handleValueMethod:C})})]})})]}),e.jsxs(b,{children:[e.jsx(v,{expandIcon:e.jsx(j,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Pricing"})}),e.jsx(y,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(me,{control:e.jsx(ue,{checked:s.offer||!1,onChange:u,name:"offer"}),label:"This listing has an offer"})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(h,{fullWidth:!0,label:"Regular Price",type:"number",name:"regularPrice",value:s.regularPrice,onChange:u,size:"small"})}),s.offer&&e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(h,{fullWidth:!0,label:"Discount Price",type:"number",name:"discountPrice",value:s.discountPrice,onChange:u,size:"small",color:"success"})})]})})]}),e.jsxs(b,{children:[e.jsx(v,{expandIcon:e.jsx(j,{}),children:e.jsx(l,{variant:"h6",fontWeight:500,children:"Upload Images"})}),e.jsxs(y,{children:[e.jsx(l,{variant:"body2",color:"text.secondary",mb:2,children:"The first image will be the cover (maximum: 6)"}),e.jsxs(a,{container:!0,spacing:2,mb:2,children:[e.jsx(a,{item:!0,xs:12,sm:8,children:e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:O,style:{width:"100%"}})}),e.jsx(a,{item:!0,xs:12,sm:4,children:e.jsx(U,{fullWidth:!0,variant:"contained",color:"success",onClick:_,disabled:p,children:p?"Uploading...":"Upload"})})]}),L&&e.jsx(l,{color:"error",variant:"body2",mb:2,children:L}),e.jsx(a,{container:!0,spacing:2,mb:2,children:s.imageURLs.map((r,t)=>e.jsxs(a,{item:!0,xs:12,sm:6,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx("img",{src:r,alt:`uploaded-${t}`,style:{width:100,height:100,borderRadius:5,objectFit:"contain"}}),e.jsx(U,{variant:"text",color:"error",onClick:()=>G(r),children:"Delete"})]},t))})]})]}),e.jsx(U,{variant:"contained",color:"success",onClick:$,disabled:p,sx:{mt:4,width:{xs:"100%",sm:"auto"},px:4,py:1.5,fontSize:{xs:"0.9rem",sm:"1rem"},alignSelf:"center",display:"block",mx:{sm:"auto"}},children:p?"Loading...":"Update"})]})})})]})})};export{We as default};
