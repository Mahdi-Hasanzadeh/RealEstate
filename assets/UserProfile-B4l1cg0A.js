function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/WaveHeader-GOCtbZ2g.js","assets/index-RV5YIsxB.js","assets/index-DDnostVl.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r,_ as re,q as R,u as le,o as ne,p as ie,b as ue,v as l,j as e,F as ce,A as de,B as p,T as g,I as me,a as y,t as B,L as pe,w as V,U as _,C as ge,D as he,y as $,E as M}from"./index-RV5YIsxB.js";import{g as fe,r as xe,u as be,a as ye}from"./index.esm2017-xdxYMBNT.js";import{a as je}from"./firebase-Dc1fJsNB.js";import{C as Ce}from"./ConfirmDialog-DBTw2uG_.js";import{C as ve}from"./Container-BPfE54Zb.js";import{T as j}from"./TextField-CP7HvCbv.js";import{I as we}from"./InputAdornment-C6iLgRYL.js";import{V as Se,a as Te}from"./VisibilityOff-C-ThD5yA.js";import"./Zoom-CT9GbHCF.js";import"./styled-DolKx1nG.js";import"./useFormControl-x1edabWd.js";import"./List-Clvs1NRc.js";const ke=r.lazy(()=>re(()=>import("./WaveHeader-GOCtbZ2g.js"),__vite__mapDeps([0,1,2]))),O=3e3,_e=()=>{const[C,q]=r.useState(!1),[N,d]=r.useState(!1),t=R(a=>a.persistData.user.userInfo),v=le(),m=ne(),A=ie(),i=ue(v.breakpoints.down("md")),E=r.useRef(null),[w,K]=r.useState(void 0),S=r.useRef(null),[h,z]=r.useState(0),[F,Q]=r.useState(""),[s,T]=r.useState(t),[k,P]=r.useState(""),[U,W]=r.useState(!1),G=()=>{q(!C)},[H,I]=r.useState(!1);R(a=>a.showListings.show);const L=()=>{I(!0)},J=()=>{I(!1)},X=()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("persist:root"),A("/signin"),m($(!1)),m(M())},Y=async()=>{try{const a=localStorage.getItem("accessToken");(await V.delete(`${_}api/user/delete/${t.id}`,{headers:{Authorization:`Bearer ${a}`}})).data?(l.success("User deleted Successfully",{autoClose:3e3}),localStorage.removeItem("accessToken"),localStorage.removeItem("persist:root"),I(!1),A("/signup"),m($(!1)),m(M())):l.error("user not deleted",{autoClose:3e3})}catch(a){l.error(a.message,{autoClose:3e3})}},Z=async a=>{var x,b,c,n;if(t.username==(s==null?void 0:s.username)&&t.email==(s==null?void 0:s.email)&&t.mobileNumber==(s==null?void 0:s.mobileNumber)&&t.avatar==(s==null?void 0:s.avatar)&&t.password==(s==null?void 0:s.password)){l.info("No changes detected");return}if(!(s!=null&&s.username)||!(s!=null&&s.email)){l.error("Username or email is empty");return}if(!/^\d+$/.test(s==null?void 0:s.mobileNumber)){l.error("Telephone number Should Contain only numbers"),P("Telephone number Should Contain only numbers");return}if((s==null?void 0:s.mobileNumber.length)<10||(s==null?void 0:s.mobileNumber.length)>10){l.error("Mobile number should be 10 digits"),P("Mobile number should be 10 digits");return}try{if(d(!0),!(await V.put(`${_}api/user/update/${t.id}`,{...s},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data)throw new Error("Update failed");const{password:Pe,...oe}=s;m(ge({...oe})),l.success("Profile Updated Successfully",{autoClose:3e3}),z(0)}catch(o){l.error((x=o==null?void 0:o.response)==null?void 0:x.data.message,{autoClose:O}),(c=(b=o==null?void 0:o.response)==null?void 0:b.data)!=null&&c.message?l.error((n=o==null?void 0:o.response)==null?void 0:n.data.message,{autoClose:3e3}):l.error(o.message,{autoClose:3e3})}finally{P(""),d(!1)}},f=a=>{a.target.name=="password"?T(u=>({...u,password:a.target.value==""?t.password:a.target.value})):T(u=>({...u,[a.target.name]:a.target.value}))},D=()=>{E.current.click()},ee=a=>{console.log(a.target.files[0]),K(a.target.files[0])};r.useEffect(()=>(w&&se(w),()=>{S.current&&(S.current.cancel(),console.log("Upload canceled due to route change."))}),[w]);const se=a=>{const u=fe(je),x=new Date().getTime()+a.name,b=xe(u,x),c=be(b,a);S.current=c,c.on("state_changed",n=>{d(!0);const o=n.bytesTransferred/n.totalBytes*100;z(o)},n=>{l.error(n.message,{autoClose:O}),Q(n.message),d(!1)},()=>{ye(c.snapshot.ref).then(async n=>{T(o=>({...o,avatar:n})),d(!1)})})},te=()=>{U?X():Y()};function ae(a){return e.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(he,{variant:"determinate",...a}),e.jsx(p,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{variant:"caption",component:"div",color:"text.secondary",children:`${Math.round(a.value)}%`})})]})}return e.jsx(e.Fragment,{children:e.jsxs(ve,{maxWidth:"md",sx:{textAlign:"center"},children:[e.jsx(r.Suspense,{fallback:e.jsx(ce,{}),children:e.jsx(ke,{title:"Profile"})}),e.jsx("input",{onChange:ee,type:"file",ref:E,hidden:!0,accept:"image/*"}),e.jsx("img",{onClick:D,src:s.avatar?s.avatar:t!=null&&t.avatar?t.avatar:de,title:t!=null&&t.username?t.username:"user image",style:{cursor:"pointer",width:"120px",objectFit:"cover",objectPosition:"center",borderRadius:50}}),e.jsx(p,{children:h>0&&h<100?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:"Uploading ..."}),e.jsx(ae,{value:h})]}):F?e.jsx(g,{variant:"body1",color:v.palette.error,children:F}):h===100&&e.jsx(g,{variant:"body1",color:v.palette.success,children:"Uploaded Successfully,Please press the update button to save changes"})}),e.jsxs(p,{component:"div",sx:{mx:"auto",mt:5,width:{xs:"99%",sm:"65%",md:"60%"},display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",flexWrap:"wrap",gap:2},children:[e.jsx(j,{type:"text",fullWidth:!0,size:i?"small":"medium",variant:"outlined",label:"Username",defaultValue:t.username,onChange:f,name:"username"}),e.jsx(j,{type:"email",fullWidth:!0,size:i?"small":"medium",variant:"outlined",label:"Email",defaultValue:t.email,onChange:f,name:"email"}),e.jsx(j,{type:C?"text":"password",fullWidth:!0,size:i?"small":"medium",variant:"outlined",label:"Password",defaultValue:"",onChange:f,name:"password",InputProps:{endAdornment:e.jsx(me,{onClick:G,children:e.jsx(we,{position:"start",children:C?e.jsx(Se,{fontSize:"small"}):e.jsx(Te,{})})})}}),!(t!=null&&t.mobileNumber)&&e.jsx(g,{sx:{color:"red"},children:"Please Add your mobile number"}),e.jsx(j,{error:!!k,type:"text",fullWidth:!0,size:i?"small":"medium",variant:"outlined",label:"Mobile Number",defaultValue:(t==null?void 0:t.mobileNumber)||"",onChange:f,name:"mobileNumber",helperText:k||null}),e.jsx(y,{fullWidth:!0,size:i?"small":"large",variant:"contained",sx:{backgroundColor:B,"&:hover":{opacity:.9,backgroundColor:B}},disabled:N,onClick:Z,children:N?"Loading...":"UPDATE"}),e.jsx(pe,{style:{width:"100%"},className:"Link",to:"/create-list",children:e.jsx(y,{fullWidth:!0,size:i?"small":"large",variant:"contained",color:"success",children:"Create listing"})}),e.jsxs(p,{sx:{width:"100%",display:"flex",justifyContent:"space-between"},children:[e.jsx(y,{variant:"text",color:"warning",size:i?"small":"large",onClick:()=>{W(!1),L()},children:"Delete Account"}),e.jsx(y,{variant:"text",color:"warning",size:i?"small":"large",onClick:()=>{W(!0),L()},children:"Sign out"})]})]}),e.jsx(Ce,{open:H,onClose:J,title:"Warning",message:U?"Are you sure you want to sign out from your account?":"Are you sure you want to delete your account?",cancelText:"Disagree",confirmText:"Agree",onConfirm:te})]})})};export{_e as default};
