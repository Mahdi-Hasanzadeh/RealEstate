import{V as B,j as t,B as h,T as p,r as o,y as D,x as N,c as m,U as f,A as g}from"./index-B5lp3evd.js";import{L as R}from"./loader-BgHL1twO.js";import{N as T,d as W,I as O}from"./ItemCard-9pp5RdRY.js";import{r as V}from"./createSvgIcon-KNrI_raX.js";import{C as q}from"./ConfirmDialog-Da_hVYY9.js";import{C as n}from"./Container-Buy3LPWA.js";import"./Card-B4F5XmKB.js";import"./CardMedia-Dy7vVkep.js";import"./isMuiElement-Cht4bAAw.js";import"./Zoom-BfKw8cCT.js";import"./styled-Dql5uali.js";var x={},M=B;Object.defineProperty(x,"__esModule",{value:!0});var C=x.default=void 0,U=M(V()),H=t;C=x.default=(0,U.default)((0,H.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline");const Y=({error:l})=>t.jsxs(h,{sx:{minHeight:"50vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",color:"error.main",px:2},children:[t.jsx(C,{sx:{fontSize:80,mb:2}}),t.jsx(p,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Something went wrong"}),t.jsx(p,{variant:"body1",children:l})]}),ae=()=>{const[l,c]=o.useState(!1),[s,S]=o.useState(null),[I,v]=o.useState(!1),[$,d]=o.useState(null),[j,u]=o.useState([]),y=D(e=>e.persistData.user.userInfo),w=N(),F=()=>c(!1),_=()=>{s!=null&&s.id&&(k(s.id),c(!1))},b=e=>{S({id:e._id,name:e.name}),c(!0)},E=e=>{const r=`/listing/${e._id},${e.mainCategoryName},${e.subCategoryName||"null"}`;w(r)},L=async()=>{var e;v(!0);try{const{data:r}=await m.get(`${f}api/user/userInfo/${y.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!((e=r==null?void 0:r.favorites)!=null&&e.length)){u([]),d(null);return}const i=r.favorites.join(","),{data:a}=await m.get(`${f}api/listing/favoriteListings?ListingsId=${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});u(a),d(null)}catch(r){d(r.message||"Something went wrong."),g.error(r.message||"Failed to fetch favorites.")}finally{v(!1)}},k=async e=>{var r,i;try{if(!(await m.put(`${f}api/user/update/${y.id}`,{favorites:e,removeFavorites:!0},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data)throw new Error("Failed to remove from favorites.");g.success("Removed from favorites."),u(z=>z.filter(A=>A._id!==e))}catch(a){g.error(((i=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:i.message)||a.message,{autoClose:3e3})}};return o.useEffect(()=>{L()},[]),I?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(h,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh",children:t.jsx(R,{})})}):$?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(Y,{})}):j.length===0?t.jsx(n,{maxWidth:"lg",sx:{py:6},children:t.jsx(T,{message:"No Favorites",description:"You havenâ€™t saved anything yet.",icon:t.jsx(W,{sx:{fontSize:80,color:"grey.500",mb:2}})})}):t.jsxs(n,{maxWidth:"lg",sx:{pb:6},children:[t.jsx(p,{variant:"h5",align:"center",sx:{color:"green",mb:4},children:"Your Favorites"}),t.jsx(h,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:3,p:2,pb:8},children:j.map((e,r)=>t.jsx(O,{item:e,onDeleteClick:()=>b(e),showView:!0,onViewClick:E},e._id||r))}),t.jsx(q,{open:l,title:"Warning",message:`Are you sure to delete listing (${s==null?void 0:s.name})?`,onClose:F,onConfirm:_,cancelText:"Disagree",confirmText:"Agree"})]})};export{ae as default};
