function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/Wave-BN2A7-La.js","assets/index-BWgtW--N.js","assets/index-B3EqNP97.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as m,_ as O,u as M,a as N,R as V,j as e,F as H,B as c,f as d,b as K,V as Q,h as P,i as n}from"./index-BWgtW--N.js";import{g as Y,r as J,u as X,a as Z}from"./index.esm2017-xdxYMBNT.js";import{a as ee}from"./firebase-Dc1fJsNB.js";import{a as z,U as F}from"./PortConfig-CL2sLOPV.js";import{C as se}from"./Container-DeYLzROt.js";import{G as L,F as h,C as p}from"./Grid-DKY8GWBm.js";import"./styled-BCIz7Izj.js";const ae=m.lazy(()=>O(()=>import("./Wave-BN2A7-La.js"),__vite__mapDeps([0,1,2]))),u=3e3,ue=()=>{const[x,I]=m.useState([]),[k,j]=m.useState(),[b,g]=m.useState(!1),D=M(),t=N(D.breakpoints.down("md")),{listingId:S}=V(),[T,v]=m.useState(!1),[a,f]=m.useState({type:"rent",description:"",imageURLs:[],parking:!1,furnished:!1,offer:!1,bedrooms:1,bath:1,regularPrice:1,discountPrice:1}),[R,y]=m.useState(null),B=async()=>{v(!0);try{const s=await z.get(`${F}api/listing/userListing/${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(s.data.success===!1){console.log(s.data.message),y(s.data.message),n.error(s.data.message,{autoClose:u});return}f(s.data)}catch(s){console.log(s.message),n.error(s.message,{autoClose:u}),y(s.message)}finally{v(!1)}};m.useEffect(()=>{B()},[]);const E=async s=>{if(s.preventDefault(),!a.name||!a.description||!a.address||a.imageURLs.length===0){console.log("Fill out the form"),n.error("Please fill out the form",{autoClose:u});return}if(parseInt(a.discountPrice)>=parseInt(a.regularPrice)){n.success("Discount price can not be bigger than or equal to regular price",{autoClose:u});return}const r=localStorage.getItem("accessToken");try{g(!0);const l=await z.put(`${F}api/listing/${a._id}`,{...a,discountPrice:a.offer?a.discountPrice:0},{headers:{Authorization:`Bearer ${r}`}});if(l.data.succeess==!1){console.log(l.data.message),j(l.data.message),n.error(l.data.succeess,{autoClose:u});return}n.success("Listing updated successfully"),f(l.data.updatedListing),y(null)}catch(l){console.log(l.message),n.error(l.message,{autoClose:u})}finally{g(!1)}},W=s=>{f(r=>({...r,imageURLs:[...a.imageURLs.filter(l=>l!==s)]}))},o=s=>{s.target.name=="parking"||s.target.name=="furnished"||s.target.name=="offer"?f(r=>({...r,[s.target.name]:s.target.name=="parking"?!a.parking:s.target.name=="furnished"?!a.furnished:!a.offer})):f(r=>({...r,[s.target.name]:(s.target.type=="text",s.target.value)}))},_=s=>{s.target.files.length<7&&I(s.target.files)},A=()=>{if(x.length>0&&x.length+a.imageURLs.length<7){const r=[];console.log("upload photo"),g(!0);for(var s=0;s<x.length;s++)r.push($(x[s]));Promise.all(r).then(l=>{f(C=>({...C,imageURLs:a.imageURLs.concat(l)})),g(!0)}).then(()=>{j(!1)}).catch(l=>{n.error("image Upload failed.Image should be 2mb ",{autoClose:u}),console.log(l.message)}).finally(()=>{g(!1)})}else j("Please choose only six images for every list"),n.error("Please choose only six images for every list",{autoClose:u})},$=async s=>new Promise((r,l)=>{const C=Y(ee),q=s.name+new Date().getTime(),G=J(C,q),U=X(G,s);U.on("state_changed",i=>{const w=i.bytesTransferred/i.totalBytes*100;console.log(w),console.log("Upload is "+Math.round(w)+"% done")},i=>{console.log("eroro upload"),n.error(i.message,{autoClose:u}),console.log(i),g(!1),l(i)},()=>{console.log("down url"),Z(U.snapshot.ref).then(i=>{r(i),console.log(i)})})});return e.jsx(e.Fragment,{children:e.jsxs(se,{maxWidth:"md",sx:{position:"relative",top:50,mb:20},children:[e.jsx(m.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(ae,{title:"Edit List"})}),T?e.jsx("h2",{children:"Loading..."}):R?e.jsx("h3",{children:R}):e.jsxs(L,{container:!0,spacing:t?0:1,justifyContent:t?"normal":"flex-start",children:[e.jsx(L,{item:!0,xs:12,md:6,children:e.jsxs(c,{component:"form",sx:{padding:2},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(d,{fullWidth:!0,type:"text",label:"Name",variant:"outlined",name:"name",value:a.name||"",onChange:o,required:!0,size:t?"small":"medium"}),e.jsx(d,{multiline:!0,fullWidth:!0,maxRows:10,type:"text",label:"Description",variant:"outlined",name:"description",value:a.description,onChange:o,required:!0,size:t?"small":"medium"}),e.jsx(d,{fullWidth:!0,maxRows:10,multiline:!0,type:"text",label:"address",variant:"outlined",name:"address",value:(a==null?void 0:a.address)||"",onChange:o,required:!0,size:t?"small":"medium"})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:{xs:"space-between",sm:"flex-start"}},children:[e.jsx(h,{value:"sell",label:"Sell",labelPlacement:"start",name:"type",onChange:o,control:e.jsx(p,{size:t?"small":"medium",checked:a.type==="sell"})}),e.jsx(h,{value:"rent",label:"Rent",labelPlacement:"start",name:"type",onChange:o,control:e.jsx(p,{size:t?"small":"medium",checked:a.type==="rent"})})]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",flexDirection:{xs:"column",sm:"row"},alignItems:"flex-start",mb:1.5},children:[e.jsx(h,{value:!0,label:"Parking spot",labelPlacement:"start",name:"parking",onChange:o,control:e.jsx(p,{size:t?"small":"medium",checked:a.parking||!1})}),e.jsx(h,{value:!0,label:"Furnished",labelPlacement:"start",name:"furnished",onChange:o,control:e.jsx(p,{size:t?"small":"medium",checked:a.furnished||!1})}),e.jsx(h,{value:!0,label:"Offer",labelPlacement:"start",name:"offer",onChange:o,control:e.jsx(p,{size:t?"small":"medium",checked:a.offer||!1})})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"flex-start",gap:3,flexWrap:"wrap"},children:[e.jsx(d,{type:"number",label:"Beds",size:t?"small":"medium",name:"bedrooms",value:a.bedrooms,onChange:o}),e.jsx(d,{type:"number",label:"Baths",size:t?"small":"medium",name:"bath",value:a.bath,onChange:o}),e.jsx(d,{type:"number",label:"Regular Price / month",size:t?"small":"medium",name:"regularPrice",value:a.regularPrice,onChange:o}),a.offer&&e.jsx(d,{type:"number",label:"Discount Price / month",size:t?"small":"medium",name:"discountPrice",value:a.discountPrice,onChange:o})]})]})}),e.jsxs(L,{item:!0,xs:12,md:6,sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(c,{children:[e.jsxs("h3",{style:{fontSize:t?"16.5px":"20px",fontWeight:"bolder",textAlign:"justify"},children:["Images:",e.jsx("span",{style:{color:K},children:"The first image will be the cover (maximum:6)"})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"flex-start",flexWrap:"wrap",gap:1.5},children:[e.jsx("input",{style:{border:"1p solid aqua",outline:"2px solid",outlineColor:Q,textIndent:"4px"},type:"file",accept:"image/*",multiple:!0,onChange:_}),e.jsx(P,{onClick:A,variant:"contained",color:"success",size:t?"small":"large",disabled:b,fullWidth:!0,children:b?"Uploading....":"UPLOAD"})]})]}),e.jsxs(c,{className:"show image section",children:[e.jsx("p",{children:k&&k}),a.imageURLs.length>0&&a.imageURLs.map((s,r)=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx("img",{width:"100",height:"100",style:{borderRadius:"5px",objectFit:"cotain"},src:s,alt:s}),e.jsx(P,{onClick:()=>{W(s)},variant:"text",color:"warning",children:"Delete"})]},r))]}),e.jsx(P,{type:"submit",onClick:E,variant:"contained",fullWidth:!0,size:t?"small":"large",color:"success",disabled:!!b,children:b?"Loading":"Edit List"})]})]})]})})};export{ue as default};
